# CPC357_Project

---

# FlowGuard: Smart Urban Drainage & Blockage Detection System

**Course:** CPC357: IoT Architecture & Smart Applications

**Institution:** Universiti Sains Malaysia (USM)

**Target:** SDG 11 - Sustainable Cities and Communities (Target 11.5 & 11.6)

---

## ðŸ“– Project Overview

**FlowGuard** is an intelligent IoT solution designed to address urban flash floods caused by drainage blockage and poor infrastructure maintenance. Unlike traditional systems that only detect water levels, FlowGuard proactively monitors the "health" of the drainage system.

By integrating an optical tripwire (Laser + LDR) with environmental sensors, the system can distinguish between natural water flow, solid waste obstructions (illegal dumping), and storm debris. Real-time telemetry is transmitted to the **ViTrox V-ONE AIoT Cloud** for visualization and alert management.

### ðŸŒ SDG 11 Alignment

This project directly contributes to **SDG 11 (Sustainable Cities and Communities)**:

* **Target 11.5 (Disaster Reduction):** Provides early warning for flash floods and prevents overflow caused by clogged drains.
* **Target 11.6 (Environmental Impact):** Detects illegal dumping of solid waste in dry drains, allowing municipal councils to clean up before pollution reaches rivers.

---

## âš™ï¸ Key Features

1. **Accurate Water Depth Calculation:**
* Inverted logic (`Total Depth - Sensor Distance`) calculates the actual depth of water in the drain, rather than just the distance from the sensor.


2. **Smart Blockage Detection:**
* Uses a **Laser Tripwire** system with a time-duration algorithm (3-second debounce) to distinguish between transient objects (falling leaves) and static blockages (trash bags).


3. **Context-Aware Alerts:**
* Correlates rain data with blockage data to identify specific scenarios:
* *Blockage + Dry:* **Illegal Dumping**
* *Blockage + Rain:* **Debris Flow**




4. **Energy Efficient:**
* Implements **Pulse Modulation** logic, activating the laser only for 10ms during measurement intervals to conserve power.



---

## ðŸ› ï¸ Hardware Architecture

### Components List

* **Microcontroller:** ESP32 Development Board (NodeMCU-32S)
* **Level Sensor:** HC-SR04 Ultrasonic Sensor
* **Blockage Transmitter:** KY-008 Laser Diode Module
* **Blockage Receiver:** LDR (Light Dependent Resistor) Module
* **Weather Context:** Rain Sensor Module

### Pin Configuration Map

Based on the provided source code, connect the components as follows:

| Component | Pin Function | ESP32 GPIO Pin | Description |
| --- | --- | --- | --- |
| **HC-SR04** | Trigger | **GPIO 5** | Output to trigger pulse |
| **HC-SR04** | Echo | **GPIO 18** | Input for sound wave return |
| **Laser** | Signal | **GPIO 4** | Pulse modulated output |
| **LDR** | Analog Out | **GPIO 34** | Analog input (ADC1) |
| **Rain Sensor** | Digital Out | **GPIO 19** | Digital input (Wet/Dry) |

> **Note:** Ensure the LDR and Rain Sensor are powered by **3.3V** to protect the ESP32 analog/digital pins. The HC-SR04 requires **5V** (VIN).

---

## ðŸ’» Software Prerequisites

To replicate this project, you need the following software and libraries:

1. **Arduino IDE** (Version 2.0 or later recommended)
2. **ESP32 Board Manager** (Install via Tools > Board > Boards Manager)
3. **Required Libraries:**
* `VOneMqttClient` (Provided by Cytron/ViTrox for V-ONE Cloud integration)
* `WiFi.h` (Standard ESP32 library)



---

## ðŸš€ Installation & Setup Guide

### 1. Cloud Setup (ViTrox V-ONE)

1. Log in to the **ViTrox V-ONE AIoT Portal**.
2. Create a new device and select **ESP32**.
3. Copy the **Device ID** generated by the platform.
4. Configure the Dashboard widgets to match the telemetry keys in the code:
* `WaterLevel` (Gauge/Graph)
* `RainStatus` (Status Indicator)
* `BlockageAlert` (Alarm/LED)
* `StatusMsg` (Text Display)



### 2. Firmware Configuration

1. Open the `FlowGuard.ino` file in Arduino IDE.
2. **Update Device Credentials:**
Replace the placeholder ID with your specific V-ONE Device ID:
```cpp
const char* MyDeviceID = "YOUR_DEVICE_ID_HERE";

```


3. **Update WiFi Credentials:**
Ensure your `vonesetting.h` (or main code) contains your WiFi SSID and Password.
4. **Calibrate Drain Depth:**
Measure the physical height of your drain model and update the constant:
```cpp
const int DRAIN_TOTAL_DEPTH = 15; // Set this to your container height in cm

```



### 3. Uploading

1. Connect the ESP32 via USB.
2. Select **Board:** `NodeMCU-32S`.
3. Select the correct **COM Port**.
4. Click **Upload**.

---

## ðŸ“Š System Logic & Decision Matrix

The system processes sensor data every 2 seconds to determine the status message sent to the cloud:

| Water Level | Blockage (Laser) | Rain Status | **System Status Output** | Meaning |
| --- | --- | --- | --- | --- |
| High (> Threshold) | Any | Any | **"Critical Flood"** | Immediate flood risk |
| Normal | **Blocked** | **Dry** | **"Illegal Dumping"** | Solid waste detected in dry drain |
| Normal | **Blocked** | **Wet** | **"Debris Flow"** | Trash/branches moving with water |
| Normal | Clear | **Wet** | **"Raining"** | Normal water flow |
| Normal | Clear | **Dry** | **"Normal"** | Drain is clear and dry |

---

## ðŸ‘¥ Contributors

* **Student 1:** [Khoo Kaa Hong] (164562)
* **Student 2:** [Axler Chin Shun Yuan] (162331)

---

## ðŸ“œ License

This project is submitted for academic assessment at Universiti Sains Malaysia. All code logic regarding the pulse modulation and blockage algorithm is original work.
